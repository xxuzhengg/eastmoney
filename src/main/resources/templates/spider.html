<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>spider</title>
    <link rel="stylesheet" href="//unpkg.com/layui@2.6.8/dist/css/layui.css">
</head>
<body>
<div class="layui-tab" style="width: 808px">
    <ul class="layui-tab-title">
        <li>获取行业的代码</li>
        <li>获取行业的月k线</li>
        <li>获取行业的月涨跌情况</li>
        <li>获取行业对应的股票信息</li>
        <li>获取过去月份的涨跌情况</li>
    </ul>
    <div class="layui-tab-content">
        <div class="layui-tab-item">
            <button id="industry" type="button" class="layui-btn layui-btn-radius layui-btn-primary">
                行业代码
            </button>
        </div>

        <div class="layui-tab-item">
            <button id="industryKLine" type="button" class="layui-btn layui-btn-radius layui-btn-primary">
                行业k线
            </button>
        </div>

        <div class="layui-tab-item">
            <div class="layui-form-item">
                <label class="layui-form-label">当前月份</label>
                <div class="layui-input-block">
                    <input type="text" id="current" placeholder="请输入数字" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">下个月份</label>
                <div class="layui-input-block">
                    <input type="text" id="next" placeholder="请输入数字" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <button id="month" type="button" class="layui-btn layui-btn-radius layui-btn-primary">
                    行业月涨跌
                </button>
            </div>
            <div class="layui-collapse" style="margin: 10px" lay-accordion>
                <div class="layui-colla-item">
                    <h2 class="layui-colla-title">当前月</h2>
                    <div class="layui-colla-content">
                        <table class="layui-table">
                            <thead>
                            <tr>
                                <th>行业代码</th>
                                <th>涨的次数</th>
                            </tr>
                            </thead>
                            <tbody id="append0"></tbody>
                        </table>
                    </div>
                </div>
                <div class="layui-colla-item">
                    <h2 class="layui-colla-title">下个月</h2>
                    <div class="layui-colla-content">
                        <table class="layui-table">
                            <thead>
                            <tr>
                                <th>行业代码</th>
                                <th>涨的次数</th>
                            </tr>
                            </thead>
                            <tbody id="append1"></tbody>
                        </table>
                    </div>
                </div>
                <div class="layui-colla-item">
                    <h2 class="layui-colla-title">交集</h2>
                    <div class="layui-colla-content">
                        <table class="layui-table">
                            <thead>
                            <tr>
                                <th>行业代码</th>
                                <th>行业名称</th>
                            </tr>
                            </thead>
                            <tbody id="append2"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="layui-tab-item">
            <form class="layui-form">
                <div class="layui-form-item">
                    <label class="layui-form-label">行业代码:</label>
                    <div class="layui-input-inline">
                        <input type="text" id="industryCode" required lay-verify="required" placeholder="请输入行业代码"
                               autocomplete="off" class="layui-input">
                    </div>
                    <button id="stock" type="button" class="layui-btn layui-btn-radius layui-btn-primary">
                        行业股票信息
                    </button>
                </div>
                <table class="layui-table">
                    <thead>
                    <tr>
                        <th>近2个月日均成交额</th>
                        <th>股票代码,股票名称</th>
                    </tr>
                    </thead>
                    <tbody id="append"></tbody>
                </table>
            </form>
        </div>

        <div class="layui-tab-item">
            <div class="layui-form-item">
                <label class="layui-form-label">日期</label>
                <div class="layui-input-block">
                    <input type="text" id="reviewDate"
                           placeholder="请输入标准日期格式.例如2021-07-15(日期必须是交易日),表示从7月15号到下个月(22个交易日)的涨跌情况"
                           autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">行业</label>
                <div class="layui-input-block">
                    <input type="text" id="reviewIndustry" placeholder="请输入行业代码" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <button id="review" type="button" class="layui-btn layui-btn-radius layui-btn-primary">
                    过去月涨跌
                </button>
            </div>
            <table class="layui-table">
                <thead>
                <tr>
                    <th>月涨跌幅度</th>
                    <th>股票代码,股票名称,近2个月日均成交额</th>
                </tr>
                </thead>
                <tbody id="append_"></tbody>
            </table>
        </div>
    </div>
</div>
<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="//unpkg.com/layui@2.6.8/dist/layui.js"></script>
<script>
    layui.use(['layer', 'element'], function () {
        var layer = layui.layer,
            element = layui.element;

        $("#industry").click(function () {
            $.ajax({
                url: "/spider/industry",
                success: function (result) {
                    layer.open({
                        title: result
                        , content: '获取行业的代码成功,已保存在redis的db0'
                    });
                },
                error: function (result) {
                    layer.open({
                        title: result
                        , content: '获取行业的代码失败'
                    });
                }
            });
        });

        $("#industryKLine").click(function () {
            $.ajax({
                url: "/spider/industryKLine",
                success: function (result) {
                    layer.open({
                        title: result
                        , content: '获取行业的月k线成功,已保存在redis的db1'
                    });
                },
                error: function (result) {
                    layer.open({
                        title: result
                        , content: '获取行业的月k线失败'
                    });
                }
            });
        });

        $("#month").click(function () {
            $.ajax({
                url: "/spider/month/" + $("#current").val() + "/" + $("#next").val(),
                success: function (result) {
                    $.each(result, function (index, obj) {
                        $("#append" + index).empty();
                        $.each(obj, function (key, value) {
                            $("#append" + index).append(
                                `<tr>
                                    <td>` + key + `</td>
                                    <td>` + value + `</td>
                                </tr>`
                            );
                        });
                    });
                    layer.open({
                        title: 'success'
                        , content: '获取行业的月涨跌情况成功'
                    });
                },
                error: function (result) {
                    layer.open({
                        title: result
                        , content: '获取行业的月涨跌情况失败'
                    });
                }
            });
        });

        $("#stock").click(function () {
            let loading;
            $.ajax({
                url: "/spider/stock/" + $("#industryCode").val(),
                beforeSend: function () {
                    loading = layer.load(1);
                },
                success: function (result) {
                    $("#append").empty();
                    $.each(result, function (key, value) {
                        $("#append").append(
                            `<tr>
                                <td>` + key + `亿元</td>
                                <td>` + value + `</td>
                             </tr>`
                        );
                    });
                    layer.close(loading);
                    layer.open({
                        title: 'success'
                        , content: '获取行业对应的股票信息成功'
                    });
                },
                error: function (result) {
                    layer.close(loading);
                    layer.open({
                        title: result
                        , content: '获取行业对应的股票信息失败'
                    });
                }
            });
        });

        $("#review").click(function () {
            let loading;
            $.ajax({
                url: "/spider/review/" + $("#reviewDate").val() + "/" + $("#reviewIndustry").val(),
                beforeSend: function () {
                    loading = layer.load(1);
                },
                success: function (result) {
                    $("#append_").empty();
                    $.each(result, function (key, value) {
                        $("#append_").append(
                            `<tr>
                                <td>` + key + `%</td>
                                <td>` + value + `</td>
                             </tr>`
                        );
                    });
                    layer.close(loading);
                    layer.open({
                        title: 'success'
                        , content: '获取过去月份的涨跌情况成功'
                    });
                },
                error: function (result) {
                    layer.close(loading);
                    layer.open({
                        title: result
                        , content: '获取过去月份的涨跌情况失败'
                    });
                }
            });
        });
    });
</script>
</body>
</html>